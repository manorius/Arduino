/*
 * This is a minimal example, see extra-examples.cpp for a version
 * with more explantory documentation, example routines, how to
 * hook up your pixels and all of the pixel types that are supported.
 *
 */
#if defined(ARDUINO) 
SYSTEM_MODE(SEMI_AUTOMATIC); 
#endif

#include "application.h"
#include "neopixel.h" // use for Build IDE
// #include "neopixel.h" // use for local build

// your network name also called SSID
char ssid[] = "digitalnihilist";
// your network password
char password[] = "manolis123456";
// your network key Index number (needed only for WEP)
int keyIndex = 0;
String readString;

TCPServer server(80);

void printWifiStatus();

// IMPORTANT: Set pixel COUNT, PIN and TYPE
#define PIXEL_PIN D8
#define PIXEL_COUNT 64
#define PIXEL_TYPE WS2812B

Adafruit_NeoPixel strip = Adafruit_NeoPixel(PIXEL_COUNT, PIXEL_PIN, PIXEL_TYPE);

int colours[10][192] = {{183,169,156,161,143,129,144,125,117,190,181,174,219,215,200,200,170,148,227,217,204,250,255,255,117,104,100,107,77,57,78,40,25,152,122,98,226,199,170,138,105,82,161,152,133,255,223,188,138,129,120,138,127,109,157,132,116,111,91,86,139,99,86,114,82,71,41,53,53,94,73,58,163,149,134,181,170,156,196,195,189,120,135,144,75,82,86,93,85,88,118,106,118,101,125,149,108,101,107,89,84,100,59,54,64,77,77,89,72,67,75,136,108,119,166,157,174,89,105,117,103,112,133,45,45,69,36,31,47,103,104,120,98,79,86,109,74,84,103,103,123,41,48,68,103,102,104,104,48,45,145,91,67,74,74,74,53,65,77,38,31,35,52,52,62,104,118,143,186,186,176,176,163,161,208,189,179,128,125,118,133,132,126,179,156,137,174,154,151,169,171,184},{31,4,23,43,37,33,18,18,6,2,0,2,32,15,17,54,36,36,38,34,21,1,4,1,123,48,126,52,40,52,86,100,63,42,28,5,14,2,2,74,54,75,45,37,46,17,17,15,85,56,86,20,12,24,66,68,53,69,44,25,34,34,46,71,84,112,76,81,97,45,37,40,0,0,0,18,12,10,15,6,13,36,18,18,147,105,115,221,227,239,191,197,211,31,24,30,0,3,6,14,6,9,0,1,0,29,12,6,227,180,176,245,242,255,190,194,210,39,37,47,8,7,1,36,30,26,37,29,28,0,0,0,141,129,139,147,141,167,57,66,93,48,45,52,26,19,22,51,41,40,30,30,30,23,20,25,52,28,38,89,43,42,22,15,18,22,18,21,49,39,38,23,17,17,30,19,21,49,34,41,49,29,42,55,30,39,38,25,31,20,17,20},{33,27,39,137,143,147,221,224,231,60,52,55,46,42,45,53,75,84,42,61,72,33,39,43,32,28,30,174,179,187,230,236,240,44,35,42,87,93,95,101,113,121,66,71,81,38,36,45,68,65,60,188,191,196,210,212,212,149,151,151,196,184,192,193,177,174,171,169,166,129,116,114,144,143,147,214,216,219,214,213,205,234,213,206,105,33,41,176,139,142,246,243,238,132,122,119,175,177,180,156,155,157,99,85,86,111,87,89,50,0,0,85,10,18,167,129,132,178,178,174,190,190,190,197,197,197,168,168,168,77,53,53,76,8,19,107,23,27,103,55,55,224,231,229,174,178,177,190,194,191,225,238,232,142,89,95,181,150,152,243,245,248,159,122,125,177,174,177,156,154,153,181,178,175,175,167,166,163,146,150,230,236,240,220,224,223,193,183,182,157,155,156},{102,81,64,72,59,39,76,59,38,83,65,37,130,109,78,132,114,80,141,120,85,114,87,66,83,67,38,117,97,72,184,161,133,146,135,104,93,81,55,131,122,95,150,131,100,131,93,68,112,93,65,97,80,50,158,143,112,206,189,167,154,126,109,78,64,49,134,108,81,139,120,89,121,106,71,122,110,86,123,105,77,139,81,58,203,126,104,78,55,35,100,86,63,134,115,87,135,116,85,149,131,103,105,80,62,90,55,37,128,90,65,135,112,84,97,87,64,60,49,31,147,134,104,124,106,78,60,37,31,113,104,83,113,110,87,144,112,87,118,98,77,39,28,14,147,136,102,94,76,58,60,31,24,53,31,19,98,93,85,156,137,116,107,87,64,47,36,20,132,122,98,99,79,58,67,41,28,55,49,37,90,85,67,78,73,55,72,61,43,50,45,37},{81,71,66,83,77,65,52,48,48,92,94,107,120,126,138,102,106,121,94,96,99,133,126,120,94,85,74,93,83,72,53,41,31,80,93,113,77,79,88,51,39,31,115,104,88,93,89,76,105,98,92,64,53,48,49,39,36,129,109,107,126,105,98,52,42,28,77,61,34,43,27,15,112,107,100,68,76,74,97,67,63,138,32,33,98,35,30,89,66,70,86,85,79,53,38,29,144,140,140,166,178,170,156,109,103,68,0,1,65,44,49,169,168,162,143,136,130,114,111,118,171,171,169,200,199,191,106,89,85,5,5,3,136,105,99,223,230,234,190,188,185,189,195,209,153,155,155,184,184,194,117,119,120,47,27,24,143,92,85,242,242,240,220,223,226,185,188,195,129,124,132,150,156,166,180,176,186,80,39,33,105,70,64,227,225,226,214,214,214,178,178,178},{180,186,198,140,132,131,67,56,40,88,82,82,78,60,58,81,83,83,94,107,111,100,94,92,127,145,147,72,97,90,124,91,88,129,88,90,105,90,75,56,43,48,15,4,6,73,72,66,145,91,103,84,31,37,180,157,163,114,67,63,144,113,133,126,72,122,70,31,38,115,104,99,236,160,159,116,29,34,170,147,155,223,172,163,54,28,45,55,32,48,81,49,50,92,81,85,159,150,143,43,28,23,103,95,106,131,105,105,0,0,0,40,23,17,38,25,23,5,12,16,46,57,65,0,0,0,72,87,106,37,48,62,10,8,9,11,7,7,42,40,47,56,52,55,11,9,16,0,2,3,61,67,69,59,57,58,26,21,27,0,0,1,33,31,30,85,81,83,22,19,22,36,33,38,59,63,62,40,37,40,23,20,23,4,3,5,2,0,0,60,57,60},{15,27,29,65,59,59,69,53,50,53,45,44,57,45,47,59,51,54,35,28,31,23,16,19,66,48,46,91,79,79,113,110,117,50,48,55,0,0,0,13,7,7,29,18,13,42,31,35,105,68,61,190,158,155,134,136,145,162,148,149,99,81,79,68,50,52,69,56,62,38,32,32,23,0,0,162,128,138,245,244,248,249,217,206,135,106,99,119,107,109,98,98,108,51,46,52,31,29,38,71,34,55,212,153,183,160,133,140,53,33,28,137,126,131,98,93,99,73,65,76,29,23,23,111,50,67,202,134,173,104,99,115,112,105,99,123,110,115,89,78,83,77,75,82,49,12,18,155,89,112,94,86,97,82,75,78,155,142,138,112,105,109,82,77,83,88,85,98,101,66,86,86,60,83,53,49,52,138,124,125,133,123,122,121,117,127,114,112,119,65,63,72},{50,46,31,103,92,60,133,127,99,103,91,63,90,80,57,56,56,36,34,37,44,28,22,22,47,54,60,47,42,26,94,78,43,51,30,0,77,68,51,127,130,125,195,201,203,73,66,69,74,83,110,0,0,1,40,28,16,100,77,57,72,62,49,211,215,204,227,237,240,50,51,57,88,84,105,84,79,71,125,109,98,167,94,73,125,94,78,150,162,164,152,151,145,93,94,100,77,77,87,187,186,170,190,184,182,127,59,42,152,90,63,58,77,85,73,88,107,107,110,115,74,67,71,193,186,179,128,110,108,90,73,93,161,131,119,58,61,66,0,13,52,65,67,78,61,51,50,168,165,162,167,130,110,115,73,75,137,138,146,155,146,135,72,54,56,78,62,59,68,57,51,166,163,158,199,187,177,141,114,117,149,151,162,177,169,155,129,110,92,84,64,59},{136,156,161,174,190,227,103,94,99,51,30,23,183,182,186,181,183,184,159,159,169,192,192,202,158,157,177,114,158,196,22,68,54,0,0,0,158,167,162,255,252,255,171,173,184,177,175,184,80,77,84,50,99,117,17,84,63,0,28,19,60,86,86,244,240,250,176,178,191,181,179,189,11,17,21,38,48,51,13,50,46,44,59,52,139,134,142,213,215,224,224,220,230,182,178,188,53,38,31,92,76,88,0,11,23,86,61,55,139,107,118,129,116,121,171,168,181,162,165,162,95,73,64,142,138,151,140,149,158,157,149,116,171,134,101,181,143,152,116,125,142,133,137,137,129,114,121,130,141,149,149,145,155,208,177,119,219,176,120,176,138,147,50,50,60,89,93,93,105,98,102,97,67,55,99,79,68,161,149,115,67,54,34,2,0,0,0,0,0,61,61,61},{79,82,63,170,149,114,159,158,126,134,145,125,147,131,70,65,61,45,39,32,26,37,31,21,80,82,67,95,88,66,86,87,78,120,108,82,82,73,54,32,29,26,37,41,31,40,31,20,134,136,136,125,134,145,90,92,95,100,75,69,95,79,76,118,130,130,138,142,139,116,102,87,181,183,186,178,183,191,163,161,158,129,96,73,99,59,37,117,99,85,141,142,135,131,130,132,125,142,146,191,189,196,167,145,135,154,109,68,132,82,41,112,70,32,116,97,79,122,118,118,40,77,81,190,177,172,193,180,176,145,135,124,178,169,152,193,183,169,131,121,107,133,127,117,33,50,45,191,171,160,216,224,238,165,174,183,165,173,172,224,220,207,179,183,170,138,148,153,75,42,19,83,98,91,143,159,160,177,175,172,137,133,133,164,150,135,148,112,76,117,96,79}};

boolean nextImage = false;
boolean fadeOut = true;
int brightness = 190;
int imageId = 0;

void setup()
{
 Serial.begin(115200);
 ///////////////////////
  // LED STRIP RELATED //
  ///////////////////////
  strip.begin();
  
strip.setBrightness(brightness);
  strip.show(); // Initialize all pixels to 'off'

 }

 
void applyColour()
{
  int rowNo = 0;
  
  for(int n=0;n<64;n++)
  { 
    int ledIndex = ((rowNo+1)%2==0)? ((rowNo+1)*8)-n-1+(rowNo*8):n;
    //Serial.println(ledIndex);
    strip.setPixelColor( ledIndex,colours[imageId][n*3],colours[imageId][(n*3)+1],colours[imageId][(n*3)+2]);
   
    strip.show(); 
    if( (n+1)%8==0 ) rowNo++;
    
  }
  

}


void loop()
{

 applyColour();
if(nextImage == false) {
  delay(5000);
}
 nextImage = true;
 Serial.println("Start Fade Out");
 
if(fadeOut)
{
  brightness--;
  
  if(brightness==0)
  {
    
  imageId = (imageId<10)? imageId+1:0;
  fadeOut = false;
  }
  
}
else{
brightness++;
if(brightness==190)
{
  fadeOut = true;
  nextImage = false;
}
}

  Serial.println(brightness);
  strip.setBrightness(brightness);
  delay(2);

}


void printWifiStatus() {
  // print the SSID of the network you're attached to:
  Serial.print("Network Name: ");
  Serial.println(WiFi.SSID());

  // print your WiFi shield's IP address:
  IPAddress ip = WiFi.localIP();
  Serial.print("IP Address: ");
  Serial.println(ip);

  // print the received signal strength:
  long rssi = WiFi.RSSI();
  Serial.print("signal strength (RSSI):");
  Serial.print(rssi);
  Serial.println(" dBm");
}


