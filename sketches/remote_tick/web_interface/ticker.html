<!DOCTYPE html>
<html lang="en">
<head>
	 <meta charset="utf-8">

    <title>Tick</title>
    <style src="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css"></style>
    <style>
.tick-box
{
display:inline-block;
width:20px;
height:20px;
border:3px solid #cccccc;
background-color: white;
}
.pointer{
	border:3px solid red;
}
.active
{
	padding:0;
	margin:0;
	width:20px;
	height:20px;
	background-color:red;
}
    </style>
</head>
<body>
	<div id="row1">
<div class="tick-box" data-index="0"><div class="inside-box "></div></div>
<div class="tick-box" data-index="1"><div class="inside-box "></div></div>
<div class="tick-box" data-index="2"><div class="inside-box "></div></div>
<div class="tick-box" data-index="3"><div class="inside-box "></div></div>
<div class="tick-box" data-index="4"><div class="inside-box "></div></div>
<div class="tick-box" data-index="5"><div class="inside-box "></div></div>
<div class="tick-box" data-index="6"><div class="inside-box "></div></div>
<div class="tick-box" data-index="7"><div class="inside-box "></div></div>
</div>
<br>
<h2 style="margin:0 10px;pading:0 0 0 0;display:inline-block">BPM</h2><input style="margin:0;pading:0" type="range" id="bpm" min="100" max="1000" value="500">

	<script   src="https://code.jquery.com/jquery-3.1.0.min.js"   integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="   crossorigin="anonymous"></script>
	<script>
	$(document).ready(function() {
		
		// ARRAY CONTAINING ACTIVE TILES
		var activeTiles      = [0,0,0,0,0,0,0,0];
		var activeTile = 0;
		// BPM
		var interval = 1000; 
		// TIMER
		var timeout;
		// TILE POINTER
		var pointer = 0;
		var previousPointer = 7;

		// STORE ELEMENTS IN ARRAY TO PREVENT DELAYS
		var tiles    = [];
		var tilesNo  = $("#row1 > .tick-box").length;
		
		for( var n = 0; n < tilesNo; n++ ){

			tiles[n] = $( "#row1 .tick-box:nth-child("+(n+1)+")" )[0];

		}
		
		$('.tick-box').on("click",function(){
			//console.log($(this).attr("data-index"));
			activateDeactivate($(this));

		
		$("#ticker").on("click",function(){
			
		}) 
	})

$("#bpm").on("change",function(){

	//console.log($(this).val())
	//updateTimer();
	interval = Number($(this).val());
})

	function activateDeactivate(target){

		var index    = target.attr("data-index");
		var child    = target.children();
		var active   = child.hasClass("active");
		//console.log(child);
		
		if(active){
			child.removeClass("active");
			activeTiles[index] = 0;
		}
		else
		{
			child.addClass("active");
			activeTiles[index] = 1;
		}
		//console.log(activeTiles);
	}

	function updateTiles()
	{


	}

	function clearTimer()
	{
	}

	function updateTimer()
	{
		

	}

	function initTimer()
	{
		
		var expected = Date.now() + interval;
		setTimeout(step, interval);

		function step() {
   			 var dt = Date.now() - expected; // the drift (positive for overshooting)
   			 if (dt > interval) {
       		 // something really bad happened. Maybe the browser (tab) was inactive?
       		 // possibly special handling to avoid futile "catch up" run
  			  }
   			//console.log("tick");
   			//console.log(pointer);

   			// HIGHLIGHT TILE
   			tiles[pointer].className = "tick-box pointer"
   			// DEACTIVATE PREVIOUS TILE
   			tiles[previousPointer].className = "tick-box"
   			//console.log(pointer+" _ "+previousPointer);
   			
   			// SEND TICK SIGNAL IF ACTIVE
   			//`console.log(activeTiles[pointer]==1);
   			if(activeTiles[pointer]==1) {
   				console.log("HIT 1\n"); console.log("Send");$.get("http://192.168.43.103/",{tick:""})
   				//console.log("HIT 2\n"); console.log("Send");$.get("http://192.168.43.96/",{tick:""})

//   				console.log("HIT 2\n"); console.log("Send");$.get("http://192.168.43.100/",{tick:""})
   			}

   			// UPDATE POINTER
   			pointer         = (pointer+1)%8;
   			previousPointer = (previousPointer+1)%8;


   			// CALCULATE DELAY IF ANY
    		expected += interval;
    		timeout = setTimeout(step, Math.max(0, interval - dt)); // take into account drift
		}
	}

	initTimer(1000);

	})
	</script>
</body>
</html>